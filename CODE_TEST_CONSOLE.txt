===========================================
CODE DE TEST SUPABASE - √Ä COPIER DANS F12
===========================================

INSTRUCTIONS :
1. Ouvrir une page web (n'importe laquelle)
2. Appuyer sur F12 (ouvrir Console)
3. Copier-coller TOUT ce code ci-dessous
4. Appuyer sur ENTR√âE
5. Observer les r√©sultats

===========================================
CODE √Ä COPIER (D√âBUT)
===========================================

(async function() {
    console.clear();
    console.log('%cüß™ TEST SUPABASE - AVANPASS v2.0.0', 'background: #667eea; color: white; padding: 10px; font-size: 16px; font-weight: bold;');
    console.log('');
    
    const SUPABASE_URL = 'https://ckzicazdmqjytxtitumy.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNremljYXpkbXFqeXR4dGl0dW15Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzI1MDUsImV4cCI6MjA4MTQwODUwNX0.BIuiBhRNDWkwBqV2hxGaDUACfkhszT4jD1qPnw8Yp7Y';
    
    function getHeaders() {
        return {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
        };
    }
    
    const results = [];
    
    // TEST 1 : Connexion
    console.log('%cüì° TEST 1 : Connexion √† Supabase...', 'color: #3b82f6; font-weight: bold;');
    try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/`, {
            method: 'GET',
            headers: getHeaders()
        });
        
        if (res.ok || res.status === 404) {
            console.log('%c‚úÖ CONNEXION R√âUSSIE', 'color: #10b981; font-weight: bold;');
            console.log(`   Statut HTTP: ${res.status}`);
            console.log(`   URL: ${SUPABASE_URL}`);
            results.push('‚úÖ Connexion : OK');
        } else {
            console.log('%c‚ùå CONNEXION √âCHOU√âE', 'color: #ef4444; font-weight: bold;');
            console.log(`   Statut HTTP: ${res.status}`);
            results.push('‚ùå Connexion : √âCHEC');
        }
    } catch (error) {
        console.log('%c‚ùå ERREUR R√âSEAU', 'color: #ef4444; font-weight: bold;');
        console.log(`   ${error.message}`);
        results.push('‚ùå Connexion : ERREUR');
    }
    
    console.log('');
    
    // TEST 2 : Lire les clients
    console.log('%cüìã TEST 2 : R√©cup√©ration des clients...', 'color: #3b82f6; font-weight: bold;');
    try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/clients?limit=5`, {
            method: 'GET',
            headers: getHeaders()
        });
        
        if (res.ok) {
            const clients = await res.json();
            console.log('%c‚úÖ CLIENTS R√âCUP√âR√âS', 'color: #10b981; font-weight: bold;');
            console.log(`   Nombre: ${clients.length}`);
            clients.forEach((c, i) => {
                console.log(`   ${i + 1}. ${c.prenom} ${c.nom} (${c.email})`);
            });
            results.push(`‚úÖ Lecture clients : OK (${clients.length} clients)`);
        } else {
            console.log('%c‚ùå ERREUR R√âCUP√âRATION', 'color: #ef4444; font-weight: bold;');
            console.log(`   Statut HTTP: ${res.status}`);
            results.push('‚ùå Lecture clients : √âCHEC');
        }
    } catch (error) {
        console.log('%c‚ùå ERREUR', 'color: #ef4444; font-weight: bold;');
        console.log(`   ${error.message}`);
        results.push('‚ùå Lecture clients : ERREUR');
    }
    
    console.log('');
    
    // TEST 3 : Cr√©er une transaction (TEST 403)
    console.log('%cüéØ TEST 3 : Cr√©ation de transaction (TEST 403)...', 'color: #3b82f6; font-weight: bold;');
    try {
        // R√©cup√©rer un client et une boutique
        const clientsRes = await fetch(`${SUPABASE_URL}/rest/v1/clients?limit=1`, {
            method: 'GET',
            headers: getHeaders()
        });
        const clients = await clientsRes.json();
        
        const boutiquesRes = await fetch(`${SUPABASE_URL}/rest/v1/boutiques?limit=1`, {
            method: 'GET',
            headers: getHeaders()
        });
        const boutiques = await boutiquesRes.json();
        
        if (clients.length === 0 || boutiques.length === 0) {
            console.log('%c‚ùå Pas de client ou boutique', 'color: #ef4444; font-weight: bold;');
            results.push('‚ùå Cr√©ation transaction : Donn√©es manquantes');
        } else {
            const client = clients[0];
            const boutique = boutiques[0];
            
            console.log(`   Client: ${client.prenom} ${client.nom}`);
            console.log(`   Boutique: ${boutique.nom_boutique}`);
            
            const transactionData = {
                client_id: client.id,
                boutique_id: boutique.id,
                type: 'passage_valide',
                valeur_points: 1,
                date_heure: new Date().toISOString(),
                commentaire: 'Test console Supabase',
                operateur: boutique.id
            };
            
            console.log('   üìù Transaction:', transactionData);
            
            const res = await fetch(`${SUPABASE_URL}/rest/v1/transactions`, {
                method: 'POST',
                headers: getHeaders(),
                body: JSON.stringify(transactionData)
            });
            
            console.log(`   Statut HTTP: ${res.status}`);
            
            if (res.ok || res.status === 201) {
                const result = await res.json();
                console.log('%c‚úÖ TRANSACTION CR√â√âE AVEC SUCC√àS !', 'color: #10b981; font-weight: bold; font-size: 14px;');
                console.log('%cüéâ PROBL√àME 403 R√âSOLU !', 'color: #10b981; font-weight: bold; font-size: 14px;');
                console.log('   Transaction:', result);
                results.push('‚úÖ Cr√©ation transaction : OK (403 R√âSOLU !)');
            } else {
                const errorText = await res.text();
                console.log('%c‚ùå ERREUR CR√âATION', 'color: #ef4444; font-weight: bold;');
                console.log(`   Statut: ${res.status}`);
                console.log(`   Message: ${errorText}`);
                results.push(`‚ùå Cr√©ation transaction : √âCHEC (${res.status})`);
            }
        }
    } catch (error) {
        console.log('%c‚ùå ERREUR', 'color: #ef4444; font-weight: bold;');
        console.log(`   ${error.message}`);
        results.push('‚ùå Cr√©ation transaction : ERREUR');
    }
    
    console.log('');
    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #6366f1;');
    console.log('%cüìä R√âSULTATS FINAUX', 'background: #6366f1; color: white; padding: 8px; font-size: 14px; font-weight: bold;');
    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #6366f1;');
    console.log('');
    
    results.forEach(r => {
        if (r.includes('‚úÖ')) {
            console.log(`%c${r}`, 'color: #10b981; font-weight: bold;');
        } else {
            console.log(`%c${r}`, 'color: #ef4444; font-weight: bold;');
        }
    });
    
    console.log('');
    
    const allOk = results.every(r => r.includes('‚úÖ'));
    
    if (allOk) {
        console.log('%cüéâ TOUS LES TESTS R√âUSSIS !', 'background: #10b981; color: white; padding: 12px; font-size: 16px; font-weight: bold;');
        console.log('');
        console.log('%c‚úÖ Supabase fonctionne parfaitement !', 'color: #10b981; font-size: 14px;');
        console.log('%c‚úÖ Lecture (GET) : OK', 'color: #10b981;');
        console.log('%c‚úÖ √âcriture (POST) : OK', 'color: #10b981;');
        console.log('%c‚úÖ Probl√®me 403 : R√âSOLU', 'color: #10b981;');
        console.log('');
        console.log('%cüöÄ Prochaine √©tape:', 'color: #f59e0b; font-weight: bold;');
        console.log('   D√©ployer l\'application AvanPass avec le nouveau js/api.js');
        console.log('   Utiliser l\'onglet "Publish" dans Genspark');
    } else {
        console.log('%c‚ö†Ô∏è CERTAINS TESTS ONT √âCHOU√â', 'background: #f59e0b; color: white; padding: 12px; font-size: 16px; font-weight: bold;');
        console.log('');
        console.log('V√©rifiez les erreurs ci-dessus');
    }
    
    console.log('');
    console.log('%cTest termin√© - AvanPass v2.0.0 (Supabase)', 'color: #999; font-style: italic;');
})();

===========================================
CODE √Ä COPIER (FIN)
===========================================

APR√àS AVOIR COPI√â-COLL√â :
- Observez les r√©sultats dans la console
- Cherchez le message "üéâ TOUS LES TESTS R√âUSSIS !"
- Screenshot de la console et envoyez

Si vous voyez "‚úÖ Cr√©ation transaction : OK (403 R√âSOLU !)"
‚Üí Supabase fonctionne !
‚Üí Le probl√®me vient uniquement du d√©ploiement Genspark

===========================================
