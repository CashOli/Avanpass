<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AvanPass - G√©n√©rateur de Donn√©es de D√©monstration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 2rem;
        }
        
        .subtitle {
            color: #6b7280;
            margin-bottom: 2rem;
        }
        
        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f3f4f6;
            border-radius: 12px;
        }
        
        .section h2 {
            font-size: 1.2rem;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        button {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .status {
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
        }
        
        .status.show {
            display: block;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        
        .code-display {
            background: #1f2937;
            color: #10b981;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin-top: 1rem;
            overflow-x: auto;
            display: none;
        }
        
        .code-display.show {
            display: block;
        }
        
        .warning {
            background: #fef3c7;
            color: #92400e;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #f59e0b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¥ AvanPass</h1>
        <p class="subtitle">G√©n√©rateur de Donn√©es de D√©monstration</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Attention :</strong> Cet outil g√©n√®re des donn√©es de test. Utilisez-le uniquement pour la d√©monstration.
        </div>
        
        <div class="section">
            <h2>üìã √âtape 1 : Codes d'Activation</h2>
            <button class="btn-primary" onclick="generateCodes()">
                G√©n√©rer 20 codes d'activation
            </button>
            <div id="codes-status" class="status"></div>
            <div id="codes-display" class="code-display"></div>
        </div>
        
        <div class="section">
            <h2>üè™ √âtape 2 : Boutiques Partenaires</h2>
            <button class="btn-primary" onclick="generateBoutiques()">
                Cr√©er 5 boutiques de d√©mo
            </button>
            <div id="boutiques-status" class="status"></div>
        </div>
        
        <div class="section">
            <h2>üë• √âtape 3 : Clients</h2>
            <button class="btn-primary" onclick="generateClients()">
                Cr√©er 10 clients de d√©mo
            </button>
            <div id="clients-status" class="status"></div>
        </div>
        
        <div class="section">
            <h2>üí≥ √âtape 4 : Transactions</h2>
            <button class="btn-primary" onclick="generateTransactions()">
                Cr√©er 50 transactions de d√©mo
            </button>
            <div id="transactions-status" class="status"></div>
        </div>
        
        <div class="section">
            <h2>‚úÖ Tout en Un</h2>
            <button class="btn-success" onclick="generateAll()">
                üöÄ G√©n√©rer Toutes les Donn√©es de D√©mo
            </button>
            <div id="all-status" class="status"></div>
        </div>
        
        <button class="btn-primary" onclick="window.location.href='index.html'" style="margin-top: 2rem;">
            ‚Üê Retour √† l'Application
        </button>
    </div>
    
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    
    <script>
        // G√©n√©rer des codes d'activation
        async function generateCodes() {
            const statusEl = document.getElementById('codes-status');
            const displayEl = document.getElementById('codes-display');
            
            statusEl.textContent = 'G√©n√©ration en cours...';
            statusEl.className = 'status show';
            displayEl.innerHTML = '';
            displayEl.classList.remove('show');
            
            try {
                const codes = [];
                for (let i = 0; i < 20; i++) {
                    const code = {
                        id: Utils.generateUUID(),
                        code_activation: Utils.generateActivationCode(),
                        statut: 'disponible',
                        client_id: null,
                        date_utilisation: null
                    };
                    await API.create('codes_activation', code);
                    codes.push(code.code_activation);
                }
                
                statusEl.textContent = '‚úÖ 20 codes g√©n√©r√©s avec succ√®s !';
                statusEl.className = 'status success show';
                
                displayEl.innerHTML = `<strong>Codes g√©n√©r√©s :</strong><br>${codes.join('<br>')}`;
                displayEl.classList.add('show');
                
            } catch (error) {
                statusEl.textContent = '‚ùå Erreur : ' + error.message;
                statusEl.className = 'status error show';
            }
        }
        
        // G√©n√©rer des boutiques
        async function generateBoutiques() {
            const statusEl = document.getElementById('boutiques-status');
            statusEl.textContent = 'Cr√©ation des boutiques...';
            statusEl.className = 'status show';
            
            const boutiquesData = [
                {
                    nom: 'Caf√© du Coin',
                    adresse: '123 Rue de la Paix',
                    ville: 'Paris',
                    responsable: 'Marie Dupont',
                    telephone: '01 23 45 67 89',
                    email: 'cafe@ducoin.fr',
                    seuil: 10,
                    recompense: '1 caf√© offert'
                },
                {
                    nom: 'Boulangerie Martin',
                    adresse: '45 Avenue Victor Hugo',
                    ville: 'Lyon',
                    responsable: 'Pierre Martin',
                    telephone: '04 12 34 56 78',
                    email: 'contact@boulangerie-martin.fr',
                    seuil: 8,
                    recompense: '1 baguette offerte'
                },
                {
                    nom: 'Salon √âl√©gance',
                    adresse: '78 Boulevard Haussmann',
                    ville: 'Paris',
                    responsable: 'Sophie Leclerc',
                    telephone: '01 98 76 54 32',
                    email: 'salon@elegance.fr',
                    seuil: 5,
                    recompense: '1 coupe gratuite'
                },
                {
                    nom: 'Pressing Express',
                    adresse: '12 Rue du Commerce',
                    ville: 'Marseille',
                    responsable: 'Ahmed Ben Ali',
                    telephone: '04 56 78 90 12',
                    email: 'pressing@express.fr',
                    seuil: 10,
                    recompense: '1 article lav√© gratuitement'
                },
                {
                    nom: 'Restaurant Le Gourmet',
                    adresse: '90 Place de la Mairie',
                    ville: 'Bordeaux',
                    responsable: 'Jean-Luc Renard',
                    telephone: '05 11 22 33 44',
                    email: 'contact@legourmet.fr',
                    seuil: 12,
                    recompense: '1 dessert offert'
                }
            ];
            
            try {
                for (const data of boutiquesData) {
                    const boutique = {
                        id: Utils.generateUUID(),
                        nom_boutique: data.nom,
                        adresse: data.adresse,
                        ville: data.ville,
                        responsable: data.responsable,
                        telephone: data.telephone,
                        statut_boutique: 'active',
                        login_commercant: data.email,
                        password_hash: await hashPassword('demo123'),
                        recompense_seuil_points: data.seuil,
                        recompense_libelle: data.recompense
                    };
                    await API.create('boutiques', boutique);
                }
                
                statusEl.textContent = `‚úÖ 5 boutiques cr√©√©es ! (Mot de passe : demo123)`;
                statusEl.className = 'status success show';
                
            } catch (error) {
                statusEl.textContent = '‚ùå Erreur : ' + error.message;
                statusEl.className = 'status error show';
            }
        }
        
        // G√©n√©rer des clients
        async function generateClients() {
            const statusEl = document.getElementById('clients-status');
            statusEl.textContent = 'Cr√©ation des clients...';
            statusEl.className = 'status show';
            
            const prenoms = ['Jean', 'Marie', 'Pierre', 'Sophie', 'Luc', 'Emma', 'Thomas', 'Julie', 'Nicolas', 'Laura'];
            const noms = ['Dupont', 'Martin', 'Bernard', 'Petit', 'Robert', 'Richard', 'Durand', 'Leroy', 'Moreau', 'Simon'];
            
            try {
                // R√©cup√©rer les codes disponibles
                const codesRes = await API.list('codes_activation', { limit: 1000 });
                const codesDisponibles = codesRes.data.filter(c => c.statut === 'disponible');
                
                if (codesDisponibles.length < 10) {
                    statusEl.textContent = '‚ö†Ô∏è Pas assez de codes disponibles. G√©n√©rez d\'abord des codes.';
                    statusEl.className = 'status error show';
                    return;
                }
                
                for (let i = 0; i < 10; i++) {
                    const client = {
                        id: Utils.generateUUID(),
                        prenom: prenoms[i],
                        nom: noms[i],
                        email: `${prenoms[i].toLowerCase()}.${noms[i].toLowerCase()}@example.com`,
                        telephone: `06 ${10 + i} 23 45 ${60 + i}`,
                        statut_carte: 'active',
                        date_activation: new Date().toISOString(),
                        date_expiration: null,
                        qr_token_client: Utils.generateQRToken()
                    };
                    await API.create('clients', client);
                    
                    // Marquer le code comme utilis√©
                    await API.patch('codes_activation', codesDisponibles[i].id, {
                        statut: 'utilise',
                        client_id: client.id,
                        date_utilisation: new Date().toISOString()
                    });
                }
                
                statusEl.textContent = '‚úÖ 10 clients cr√©√©s avec succ√®s !';
                statusEl.className = 'status success show';
                
            } catch (error) {
                statusEl.textContent = '‚ùå Erreur : ' + error.message;
                statusEl.className = 'status error show';
            }
        }
        
        // G√©n√©rer des transactions
        async function generateTransactions() {
            const statusEl = document.getElementById('transactions-status');
            statusEl.textContent = 'Cr√©ation des transactions...';
            statusEl.className = 'status show';
            
            try {
                const [clientsRes, boutiquesRes] = await Promise.all([
                    API.list('clients', { limit: 1000 }),
                    API.list('boutiques', { limit: 1000 })
                ]);
                
                const clients = clientsRes.data.filter(c => c.statut_carte === 'active');
                const boutiques = boutiquesRes.data.filter(b => b.statut_boutique === 'active');
                
                if (clients.length === 0 || boutiques.length === 0) {
                    statusEl.textContent = '‚ö†Ô∏è Cr√©ez d\'abord des clients et des boutiques.';
                    statusEl.className = 'status error show';
                    return;
                }
                
                for (let i = 0; i < 50; i++) {
                    const client = clients[Math.floor(Math.random() * clients.length)];
                    const boutique = boutiques[Math.floor(Math.random() * boutiques.length)];
                    const isPassage = Math.random() > 0.2; // 80% passages, 20% r√©compenses
                    
                    const transaction = {
                        id: Utils.generateUUID(),
                        date_heure: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                        boutique_id: boutique.id,
                        client_id: client.id,
                        type: isPassage ? 'passage_valide' : 'recompense_utilisee',
                        valeur_points: isPassage ? 1 : -boutique.recompense_seuil_points,
                        commentaire: isPassage ? '' : boutique.recompense_libelle,
                        operateur: boutique.id
                    };
                    await API.create('transactions', transaction);
                }
                
                statusEl.textContent = '‚úÖ 50 transactions cr√©√©es avec succ√®s !';
                statusEl.className = 'status success show';
                
            } catch (error) {
                statusEl.textContent = '‚ùå Erreur : ' + error.message;
                statusEl.className = 'status error show';
            }
        }
        
        // G√©n√©rer tout
        async function generateAll() {
            const statusEl = document.getElementById('all-status');
            statusEl.textContent = 'üöÄ G√©n√©ration de toutes les donn√©es en cours...';
            statusEl.className = 'status show';
            
            try {
                await generateCodes();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await generateBoutiques();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await generateClients();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await generateTransactions();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                statusEl.textContent = '‚úÖ Toutes les donn√©es de d√©mo ont √©t√© g√©n√©r√©es avec succ√®s ! Retournez √† l\'application pour tester.';
                statusEl.className = 'status success show';
                
            } catch (error) {
                statusEl.textContent = '‚ùå Erreur : ' + error.message;
                statusEl.className = 'status error show';
            }
        }
        
        // Fonction de hash simple
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }
    </script>
</body>
</html>
