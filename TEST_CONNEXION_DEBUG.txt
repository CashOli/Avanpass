===========================================
TEST DEBUG CONNEXION CLIENT
===========================================

INSTRUCTIONS :
1. Aller sur : https://58942688-c805-48f2-a1c5-03de286e6110.vip.gensparksite.com
2. Appuyer sur F12 (Console)
3. Copier-coller ce code
4. Appuyer sur ENTR√âE
5. Observer les r√©sultats

===========================================
CODE √Ä COPIER
===========================================

(async function() {
    console.clear();
    console.log('%cüîç TEST DEBUG CONNEXION CLIENT', 'background: #667eea; color: white; padding: 10px; font-size: 16px; font-weight: bold;');
    console.log('');
    
    const email = 'jean.dupont@test.fr';
    const password = 'demo123';
    
    console.log('üìß Email test√©:', email);
    console.log('üîë Mot de passe test√©:', password);
    console.log('');
    
    // √âtape 1 : Chercher le client
    console.log('%cüìã √âTAPE 1 : Recherche du client...', 'color: #3b82f6; font-weight: bold;');
    try {
        const clientsResponse = await API.list('clients', { limit: 1000 });
        console.log(`   Nombre de clients trouv√©s: ${clientsResponse.data.length}`);
        
        const client = clientsResponse.data.find(c => c.email && c.email.toLowerCase() === email.toLowerCase());
        
        if (!client) {
            console.log('%c‚ùå CLIENT NON TROUV√â', 'color: #ef4444; font-weight: bold;');
            console.log('   Emails dans la base:');
            clientsResponse.data.forEach(c => {
                console.log(`   - ${c.email}`);
            });
            return;
        }
        
        console.log('%c‚úÖ CLIENT TROUV√â', 'color: #10b981; font-weight: bold;');
        console.log('   Client:', client);
        console.log('   Email:', client.email);
        console.log('   Nom:', client.prenom, client.nom);
        console.log('   Statut carte:', client.statut_carte);
        console.log('   Password hash (BDD):', client.password_hash);
        console.log('');
        
        // √âtape 2 : Hash du mot de passe
        console.log('%cüîê √âTAPE 2 : V√©rification du mot de passe...', 'color: #3b82f6; font-weight: bold;');
        
        const passwordHash = await Auth.hashPassword(password);
        console.log('   Hash calcul√©:', passwordHash);
        console.log('   Hash attendu:', client.password_hash);
        console.log('   Match:', passwordHash === client.password_hash ? '‚úÖ OUI' : '‚ùå NON');
        console.log('');
        
        if (passwordHash !== client.password_hash) {
            console.log('%c‚ùå MOT DE PASSE INCORRECT', 'color: #ef4444; font-weight: bold;');
            console.log('   Le hash ne correspond pas !');
            console.log('');
            console.log('üîß SOLUTION : Mettre √† jour le hash dans Supabase');
            console.log(`   UPDATE clients SET password_hash = '${passwordHash}' WHERE email = '${email}';`);
            return;
        }
        
        console.log('%c‚úÖ MOT DE PASSE CORRECT', 'color: #10b981; font-weight: bold;');
        console.log('');
        
        // √âtape 3 : V√©rifier le statut
        console.log('%cüé´ √âTAPE 3 : V√©rification du statut de la carte...', 'color: #3b82f6; font-weight: bold;');
        console.log('   Statut:', client.statut_carte);
        
        if (client.statut_carte === 'inactive') {
            console.log('%c‚ö†Ô∏è CARTE INACTIVE', 'color: #f59e0b; font-weight: bold;');
            console.log('   La carte doit √™tre activ√©e avec un code');
            return;
        }
        
        if (client.statut_carte === 'suspendue') {
            console.log('%c‚ö†Ô∏è CARTE SUSPENDUE', 'color: #f59e0b; font-weight: bold;');
            return;
        }
        
        if (client.statut_carte === 'expiree') {
            console.log('%c‚ö†Ô∏è CARTE EXPIR√âE', 'color: #f59e0b; font-weight: bold;');
            return;
        }
        
        if (client.statut_carte === 'active') {
            console.log('%c‚úÖ CARTE ACTIVE', 'color: #10b981; font-weight: bold;');
        }
        
        console.log('');
        console.log('%cüéâ CONNEXION DEVRAIT FONCTIONNER !', 'background: #10b981; color: white; padding: 10px; font-size: 14px; font-weight: bold;');
        console.log('');
        console.log('Toutes les v√©rifications sont pass√©es.');
        console.log('Si la connexion √©choue quand m√™me, il y a un autre probl√®me.');
        
    } catch (error) {
        console.log('%c‚ùå ERREUR', 'color: #ef4444; font-weight: bold;');
        console.log('   Message:', error.message);
        console.log('   Stack:', error.stack);
    }
})();

===========================================
FIN DU CODE
===========================================

R√âSULTATS POSSIBLES :

1. "‚ùå CLIENT NON TROUV√â"
   ‚Üí Le client n'existe pas dans Supabase
   ‚Üí R√©ex√©cuter le script SQL d'insertion

2. "‚ùå MOT DE PASSE INCORRECT"
   ‚Üí Le hash ne correspond pas
   ‚Üí Copier la commande SQL affich√©e et l'ex√©cuter dans Supabase

3. "‚ö†Ô∏è CARTE INACTIVE"
   ‚Üí La carte n'est pas activ√©e
   ‚Üí Changer le statut en 'active' dans Supabase

4. "üéâ CONNEXION DEVRAIT FONCTIONNER !"
   ‚Üí Tout est OK, r√©essayer la connexion normale
