===========================================
TEST VALIDATION POINTS - SUPABASE
===========================================

ğŸ¯ OBJECTIF : VÃ©rifier que l'erreur HTTP 403 est rÃ©solue

Date : 16 dÃ©cembre 2024
Version : AvanPass 2.0.0 (Supabase)

===========================================
PRÃ‰PARATION
===========================================

1. VIDER LE CACHE (OBLIGATOIRE)
   
   Sur PC :
   - Ctrl + Shift + R (plusieurs fois)
   - Ou : F12 â†’ Application â†’ Clear storage
   
   Sur Mobile (Samsung Internet) :
   - RedÃ©marrer le tÃ©lÃ©phone (force le reload)
   - Ou : ParamÃ¨tres â†’ Effacer donnÃ©es navigation


2. OUVRIR LA CONSOLE (PC uniquement)
   
   - Appuyer sur F12
   - Onglet : Console
   - VÃ©rifier le message :
     âœ… "API Supabase initialisÃ©e: https://ckzicazdmqjytxtitumy.supabase.co"

===========================================
SCÃ‰NARIO DE TEST
===========================================

Ã‰TAPE 1 : Connexion Client (PC)
--------------------------------
URL      : https://puvlagux.gensparkspace.com
Action   : Cliquer "Client" â†’ "Se connecter"
Email    : jean.dupont@test.fr
Password : demo123

RÃ©sultat attendu :
âœ… Carte affichÃ©e
âœ… QR Code visible (320x320px)
âœ… "Jean DUPONT"
âœ… "0 / 10 POINTS" (ou plus si dÃ©jÃ  validÃ©)
âœ… Badge vert "âœ… ActivÃ©e"


Ã‰TAPE 2 : Connexion CommerÃ§ant (Mobile)
---------------------------------------
URL      : https://puvlagux.gensparkspace.com
Action   : Cliquer "CommerÃ§ant" â†’ Se connecter
Email    : cafe@ducoin.fr
Password : demo123

RÃ©sultat attendu :
âœ… Dashboard affichÃ©
âœ… "Snack boutique"
âœ… Bouton "Scanner QR Code" visible


Ã‰TAPE 3 : Scanner le QR Code
-----------------------------
Sur Mobile (CommerÃ§ant) :
- Cliquer : "Scanner QR Code"
- Autoriser la camÃ©ra
- Scanner le QR code affichÃ© sur le PC (Client)

RÃ©sultat attendu :
âœ… DÃ©tection du QR
âœ… Message : "Client scannÃ© : Jean DUPONT"
âœ… Affichage des points actuels
âœ… Bouton "Valider 1 passage (+1 point)"


Ã‰TAPE 4 : Valider le Passage (CRITIQUE)
---------------------------------------
Sur Mobile (CommerÃ§ant) :
- Cliquer : "Valider 1 passage (+1 point)"
- Attendre 2-3 secondes

ğŸ¯ RÃ‰SULTAT ATTENDU (SUCCÃˆS) :
âœ… Message : "Passage validÃ© avec succÃ¨s ! +1 point"
âœ… Redirection automatique vers le dashboard (2 sec)
âœ… AUCUNE erreur 403

âŒ RÃ‰SULTAT EN CAS D'Ã‰CHEC :
âŒ Message : "Erreur lors de la validation"
âŒ Popup dÃ©taillÃ© avec :
   - Message d'erreur
   - Code HTTP (400/404/500)
   - ID client
   - ID boutique
   - Action tentÃ©e


Ã‰TAPE 5 : VÃ©rification Console (PC)
-----------------------------------
Sur PC (F12 â†’ Console) :

Messages attendus :
ğŸ“ "CrÃ©ation dans transactions: {...}"
âœ… "CrÃ©ation rÃ©ussie: {...}"
âœ… "Passage validÃ© avec succÃ¨s"

Messages d'erreur possibles :
âŒ "Erreur API create: 403 - {...}"
âŒ "Erreur API create: 400 - {...}"
âŒ "Erreur create transactions: ..."


Ã‰TAPE 6 : VÃ©rification Supabase
--------------------------------
1. Aller sur : https://supabase.com/dashboard/project/ckzicazdmqjytxtitumy
2. Cliquer : Table Editor â†’ transactions
3. VÃ©rifier :
   âœ… 1 nouvelle ligne crÃ©Ã©e
   âœ… type : "passage_valide"
   âœ… valeur_points : 1
   âœ… client_id : (UUID de Jean Dupont)
   âœ… boutique_id : (UUID de Snack boutique)
   âœ… date_heure : (timestamp actuel)


Ã‰TAPE 7 : VÃ©rification Carte Client
------------------------------------
Sur PC (Client) :
- RafraÃ®chir la page : F5
- Se reconnecter : jean.dupont@test.fr / demo123
- VÃ©rifier :
   âœ… Points mis Ã  jour : "1 / 10 POINTS" (ou +1 si dÃ©jÃ  des points)
   âœ… Barre de progression : +10% (1 point sur 10)

===========================================
CODES DE RETOUR HTTP
===========================================

âœ… 200 OK         : Lecture rÃ©ussie (GET)
âœ… 201 Created    : CrÃ©ation rÃ©ussie (POST)
âœ… 204 No Content : Suppression rÃ©ussie (DELETE)

âŒ 400 Bad Request     : DonnÃ©es invalides (champ manquant)
âŒ 401 Unauthorized    : Non authentifiÃ©
âŒ 403 Forbidden       : AccÃ¨s refusÃ© (ANCIEN PROBLÃˆME)
âŒ 404 Not Found       : Table inexistante
âŒ 500 Internal Error  : Erreur serveur

===========================================
DIAGNOSTIC EN CAS D'ERREUR
===========================================

Si HTTP 403 (Erreur d'accÃ¨s) :
-------------------------------
1. VÃ©rifier dans js/api.js :
   - supabaseUrl prÃ©sent ?
   - supabaseKey prÃ©sent ?
   - Headers bien configurÃ©s ?

2. VÃ©rifier dans Supabase Dashboard :
   - Settings â†’ API â†’ anon public key
   - Table Editor â†’ transactions (accessible ?)
   - SQL Editor â†’ SELECT * FROM transactions (fonctionne ?)

3. VÃ©rifier RLS (Row Level Security) :
   - Table Editor â†’ transactions â†’ RLS doit Ãªtre vert
   - Politiques : "Enable insert for all users" doit exister


Si HTTP 400 (DonnÃ©es invalides) :
----------------------------------
1. Console (F12) : Voir l'objet envoyÃ©
2. VÃ©rifier que tous les champs requis sont prÃ©sents :
   âœ… client_id (UUID)
   âœ… boutique_id (UUID)
   âœ… type ("passage_valide")
   âœ… valeur_points (1)


Si HTTP 404 (Table non trouvÃ©e) :
----------------------------------
1. Supabase Dashboard â†’ Table Editor
2. VÃ©rifier que la table "transactions" existe
3. Si absente : Relancer le script SQL de crÃ©ation


Si Cache non vidÃ© :
-------------------
SymptÃ´me : Pas de message "API Supabase initialisÃ©e" dans console
Solution :
1. Fermer TOUS les onglets du site
2. Fermer le navigateur complÃ¨tement
3. Rouvrir le navigateur
4. Aller sur le site (Ctrl+Shift+R)
5. VÃ©rifier console : Message Supabase doit apparaÃ®tre

===========================================
CHECKLIST DE TEST
===========================================

Avant le test :
â˜ Cache vidÃ© (PC)
â˜ Cache vidÃ© (Mobile)
â˜ Console ouverte (F12)
â˜ Supabase Dashboard ouvert (onglet sÃ©parÃ©)

Pendant le test :
â˜ Client connectÃ© (jean.dupont@test.fr)
â˜ QR Code affichÃ© sur PC
â˜ CommerÃ§ant connectÃ© (cafe@ducoin.fr)
â˜ QR Code scannÃ© avec succÃ¨s
â˜ Validation cliquÃ©e

RÃ©sultats Ã  noter :
â˜ Message succÃ¨s/erreur (screenshot)
â˜ Console logs (screenshot)
â˜ Supabase transactions (screenshot)
â˜ Points client mis Ã  jour (screenshot)

===========================================
LOGS ATTENDUS (Console PC)
===========================================

âœ… SUCCÃˆS (logs attendus) :
---------------------------
âœ… API Supabase initialisÃ©e: https://ckzicazdmqjytxtitumy.supabase.co
ğŸ“ CrÃ©ation dans transactions: {
  client_id: "650e8400-e29b-41d4-a716-446655440001",
  boutique_id: "550e8400-e29b-41d4-a716-446655440001",
  type: "passage_valide",
  valeur_points: 1,
  date_heure: "2024-12-16T10:30:00.000Z",
  commentaire: "",
  operateur: "550e8400-e29b-41d4-a716-446655440001"
}
âœ… CrÃ©ation rÃ©ussie: {id: "...", client_id: "...", ...}
âœ… Passage validÃ© avec succÃ¨s


âŒ Ã‰CHEC (logs d'erreur) :
--------------------------
âŒ Erreur API create: 403 - {"code":"42501","message":"..."}
âŒ Erreur create transactions: Error: Erreur API: 403
âŒ Erreur lors de la validation

===========================================
COMPTES DE TEST DISPONIBLES
===========================================

CLIENTS (tous avec password: demo123)
-------------------------------------
1. jean.dupont@test.fr     - Jean Dupont
2. marie.martin@test.fr    - Marie Martin
3. pierre.bernard@test.fr  - Pierre Bernard
4. sophie.dubois@test.fr   - Sophie Dubois
5. gustos.olivier@test.fr  - Gustos Olivier

BOUTIQUES
---------
1. cafe@ducoin.fr          - Snack boutique (password: demo123)

CODES ACTIVATION (si besoin)
-----------------------------
AVANPASS-2024-001
AVANPASS-2024-002
AVANPASS-2024-003
AVANPASS-2024-004
AVANPASS-2024-005

===========================================
CONTACT SI PROBLÃˆME
===========================================

Si le test Ã©choue, envoyer :

1. âœ… Screenshot du message d'erreur (mobile)
2. âœ… Screenshot de la console (PC, F12)
3. âœ… Screenshot du Network tab (F12 â†’ Network â†’ supabase.co)
4. âœ… Texte exact de l'erreur

Informations utiles :
- Navigateur mobile : Samsung Internet / Chrome / Safari
- Navigateur PC : Chrome / Firefox / Edge
- Cache vidÃ© : Oui / Non
- Message console : (copier-coller)

===========================================
FIN DU PROTOCOLE DE TEST
===========================================

Version : AvanPass 2.0.0 (Supabase)
Date : 16 dÃ©cembre 2024
Objectif : RÃ©solution HTTP 403 âœ…
